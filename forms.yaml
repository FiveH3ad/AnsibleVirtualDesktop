categories: # a list of categories to group forms
  - name: Default
    icon: bars
roles: # a list of roles
  - name: admin
    groups:
      - local/admins
  - name: public
    groups: []
constants:
  awx_instance: 'awx.aks.cloudlab01.net' # Add your AWX instance URL here
forms: # a list of forms
  - name: Create Azure Windows VM
    showHelp: true
    help: >
      This form creates a new Azure Windows VM with default configurations installed.
    roles:
      - public
    description: Creates new Azure Windows VM
    categories:
      - Azure
      - Virtual Machines
      - Windows
    icon: desktop
    template: demo2
    type: awx
    credentials:
      awx_rest: 'awx' # Define your AWX REST API credential name here
    fields:
      - type: enum
        name: customer_full
        label: Customer
        values:
        - Customer 1
        - Customer 2
        default: __auto__
      - type: expression
        name: organization_id
        label: Organization ID
        expression: "fn.fnRestJwtSecure('get', 'https://$(awx_instance)/api/v2/organizations/?search=$(customer_full)', '', 'awx_rest', '[.results[] | select(.name == \"$(customer_full)\").id]')"
        hide: true
      - type: expression
        name: vm_create_workflow_id
        hide: true
        expression: "fn.fnRestJwtSecure('get', 'https://$(awx_instance)/api/v2/organizations/$(organization_id[0])/workflow_job_templates/?search=vm_create', '', 'awx_rest', '[.results[0].id]')"
      - type: expression
        name: subscription_id
        label: Subscription ID
        default: __auto__
        expression: "fn.fnRestJwtSecure('get','https://$(awx_instance)/api/v2/workflow_job_templates/$(vm_create_workflow_id)/survey_spec/','','awx_rest','[.spec | select(.variable == resource_group).choices]')"
